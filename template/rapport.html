{% extends 'index.html' %} {% block content %}
<div class="toast-container">
  {% with messages = get_flashed_messages(with_categories=true) %} {% for
  category, message in messages %}
  <div
    class="toast align-items-center text-bg-{{ 'success' if category == 'success' else 'danger' }} border-0 mb-2"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">{{ message }}</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
  {% endfor %} {% endwith %}
</div>
<div id="reports-content" class="content-section">
  <div class="container-fluid p-4">
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <div class="report-icon mb-3">
              <i class="fas fa-calendar-check"></i>
            </div>
            <h5 class="card-title">Rapport de présence</h5>
            <p class="card-text">
              Générer un rapport détaillé des présences par période
            </p>
            <form
              method="get"
              class="row g-2 align-items-end mb-4"
              id="form-fiche-presence"
              onsubmit="event.preventDefault(); telechargerFichePresence('presence', document.getElementById('btn-fiche-presence'));"
            >
              <div class="col-auto">
                <label for="date_debut" class="form-label mb-0"
                  >Date début</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="date_debut"
                  name="date_debut"
                  required
                />
              </div>
              <div class="col-auto">
                <label for="date_fin" class="form-label mb-0">Date fin</label>
                <input
                  type="date"
                  class="form-control"
                  id="date_fin"
                  name="date_fin"
                  required
                />
              </div>
              <div class="col-auto">
                <button
                  
                  id="btn-fiche-presence"
                  type="submit"
                  class="btn btn-primary btn-generer-fiche"
                  >Générer</button
                >
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <div class="report-icon mb-3">
              <i class="fas fa-user-clock"></i>
            </div>
            <h5 class="card-title">Rapport de retards</h5>
            <p class="card-text">
              Analyser les retards par département et employé
            </p>
            <button
              class="btn btn-primary btn-generer-fiche"
              onclick="telechargerFichePresence('retard', this)"
            >
              Générer
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <div class="report-icon mb-3">
              <i class="fas fa-user-times"></i>
            </div>
            <h5 class="card-title">Rapport d'absences</h5>
            <p class="card-text">Suivre les absences et leurs justifications</p>
            <button
              class="btn btn-primary btn-generer-fiche"
              onclick="telechargerFichePresence('absence', this)"
            >
              Générer
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <div class="report-icon mb-3">
              <i class="fas fa-chart-line"></i>
            </div>
            <h5 class="card-title">Rapport personnalisé</h5>
            <p class="card-text">
              Créer un rapport avec des critères spécifiques
            </p>
            <button
              class="btn btn-primary btn-generer-fiche"
              onclick="telechargerFichePresence('custom', this)"
            >
              Générer
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header bg-white">
        <h5 class="card-title mb-0">Rapports récents</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Nom du rapport</th>
                <th>Type</th>
                <th>Période</th>
                <th>Généré par</th>
                <th>Date de génération</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for rapport in resultat %}
              <tr>
                <td>{{ rapport.nom }}</td>
                <td>{{ rapport.type }}</td>
                <td>{{ rapport.periode }}</td>
                <td>{{ rapport.auteur }}</td>
                <td>{{ rapport.date }}</td>
                <td>
                  <a
                    href="{{ url_for('telecharger_rapport', nom=rapport.nom) }}"
                    class="btn btn-sm btn-outline-primary me-1"
                  >
                    <i class="fas fa-download"></i>
                  </a>
                  <a
                    href="{{ url_for('imprimer_rapport', nom=rapport.nom) }}"
                    target="_blank"
                    class="btn btn-sm btn-outline-secondary me-1"
                  >
                    <i class="fas fa-print"></i>
                  </a>
                  <a
                    href="{{ url_for('supprimer_rapport', nom=rapport.nom) }}"
                    class="btn btn-sm btn-outline-danger"
                  >
                    <i class="fas fa-trash"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="progress mb-2 d-none" style="height: 6px">
      <div
        id="progress-bar-fiche"
        class="progress-bar bg-primary"
        role="progressbar"
        style="width: 0%"
      ></div>
    </div>
  </div>
</div>

{% endblock %}
